version: 2
jobs:
  build:
    machine:
      java:
        version: openjdk7
    steps:
      - checkout
      - run: ant test
      - run: jar -cvf sample.war META-INF/ WEB-INF/ hello.jsp images/ index.html
  
  deploy:
    machine:
      java:
        version: openjdk7
    steps:
      - checkout
      - run: ant test
      - run: jar -cvf /home/circleci/project/sample.war META-INF/ WEB-INF/ hello.jsp images/ index.html
      - run: aws s3 sync /home/circleci/project/sample.war s3://build-artifacts-java-aig-test/java-apps/ --delete

workflows:
  version: 2
  build-deploy:
    jobs:
      - build
      - deploy:
          requires:
            - build     
